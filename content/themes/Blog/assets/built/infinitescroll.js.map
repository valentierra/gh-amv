{"version":3,"sources":["infinitescroll.js"],"names":["$","currentPage","pathname","window","location","$document","document","$result","buffer","ticking","isLoading","lastScrollY","scrollY","lastWindowHeight","innerHeight","lastDocumentHeight","height","onScroll","requestTick","onResize","requestAnimationFrame","infiniteScroll","maxPages","nextPage","get","content","posts","createRange","createContextualFragment","querySelectorAll","length","forEach","call","post","appendChild","fail","xhr","status","removeEventListener","passive","always","replace","addEventListener"],"mappings":"AACAA,EAAE,SAAUA,GACR,IAAIC,EAAc,EACdC,EAAWC,OAAOC,SAASF,SAC3BG,EAAYL,EAAEM,UACdC,EAAUP,EAAE,wBACZQ,EAAS,IAETC,GAAU,EACVC,GAAY,EAEZC,EAAcR,OAAOS,QACrBC,EAAmBV,OAAOW,YAC1BC,EAAqBV,EAAUW,SAKnC,SAASC,IACLN,EAAcR,OAAOS,QACrBM,IAGJ,SAASC,IACLN,EAAmBV,OAAOW,YAC1BC,EAAqBV,EAAUW,SAC/BE,IAGJ,SAASA,IACAT,GACDW,sBAAsBC,GAE1BZ,GAAU,EAGd,SAASY,IAEL,IAAIX,EAKJ,GAAIC,EAAcE,GAAoBE,EAAqBP,EACvDC,GAAU,OAKd,GAAIR,IAAgBqB,SAApB,CAIAZ,GAAY,EAMZ,IAAIa,EAAWrB,EAAW,WAH1BD,EAGkD,IAElDD,EAAEwB,IAAID,EAAU,SAAUE,GACtB,IACIC,EADQpB,SAASqB,cAAcC,yBAAyBH,GAC1CI,iBAAiB,mBAC/BH,EAAMI,QACN,GAAGC,QAAQC,KAAKN,EAAO,SAAUO,GAC7B1B,EAAQ,GAAG2B,YAAYD,OAGhCE,KAAK,SAAUC,GAEK,MAAfA,EAAIC,SACJlC,OAAOmC,oBAAoB,SAAUrB,EAAU,CAACsB,SAAS,IACzDpC,OAAOmC,oBAAoB,SAAUnB,MAE1CqB,OAAO,WACNzB,EAAqBV,EAAUW,SAE/BP,EADAC,GAAY,KA7DpBR,EAAWA,EAASuC,QAAQ,UAAW,IAAIA,QAAQ,OAAS,KAkE5DtC,OAAOuC,iBAAiB,SAAUzB,EAAU,CAACsB,SAAS,IACtDpC,OAAOuC,iBAAiB,SAAUvB,GAElCE","file":"infinitescroll.js","sourcesContent":["// Code snippet inspired by https://github.com/douglasrodrigues5/ghost-blog-infinite-scroll\n$(function ($) {\n    var currentPage = 1;\n    var pathname = window.location.pathname;\n    var $document = $(document);\n    var $result = $('.js-scroll-container');\n    var buffer = 200;\n\n    var ticking = false;\n    var isLoading = false;\n\n    var lastScrollY = window.scrollY;\n    var lastWindowHeight = window.innerHeight;\n    var lastDocumentHeight = $document.height();\n\n    // remove hash params from pathname\n    pathname = pathname.replace(/#(.*)$/g, '').replace('/\\//g', '/');\n\n    function onScroll() {\n        lastScrollY = window.scrollY;\n        requestTick();\n    }\n\n    function onResize() {\n        lastWindowHeight = window.innerHeight;\n        lastDocumentHeight = $document.height();\n        requestTick();\n    }\n\n    function requestTick() {\n        if (!ticking) {\n            requestAnimationFrame(infiniteScroll);\n        }\n        ticking = true;\n    }\n\n    function infiniteScroll() {\n        // return if already loading\n        if (isLoading) {\n            return;\n        }\n\n        // return if not scroll to the bottom\n        if (lastScrollY + lastWindowHeight <= lastDocumentHeight - buffer) {\n            ticking = false;\n            return;\n        }\n\n        // return if currentPage is the last page already\n        if (currentPage === maxPages) {\n            return;\n        }\n\n        isLoading = true;\n\n        // next page\n        currentPage++;\n\n        // Load more\n        var nextPage = pathname + 'page/' + currentPage + '/';\n\n        $.get(nextPage, function (content) {\n            var parse = document.createRange().createContextualFragment(content);\n            var posts = parse.querySelectorAll('.js-scroll-item');\n            if (posts.length) {\n                [].forEach.call(posts, function (post) {\n                    $result[0].appendChild(post);\n                });\n            }\n        }).fail(function (xhr) {\n            // 404 indicates we've run out of pages\n            if (xhr.status === 404) {\n                window.removeEventListener('scroll', onScroll, {passive: true});\n                window.removeEventListener('resize', onResize);\n            }\n        }).always(function () {\n            lastDocumentHeight = $document.height();\n            isLoading = false;\n            ticking = false;\n        });\n    }\n\n    window.addEventListener('scroll', onScroll, {passive: true});\n    window.addEventListener('resize', onResize);\n\n    infiniteScroll();\n});\n"]}